<!DOCTYPE html>
  <html lang="ja">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">     
      <title>â›³ ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ«</title>
      <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.16754694     
  04/pose.js"></script>
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
      <style>
          body {
              font-family: Arial, sans-serif;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);     
              margin: 0;
              padding: 20px;
          }
          .container {
              max-width: 1000px;
              margin: 0 auto;
              background: white;
              border-radius: 15px;
              padding: 30px;
          }
          .header {
              text-align: center;
              margin-bottom: 30px;
          }
          .upload-area {
              border: 3px dashed #667eea;
              border-radius: 10px;
              padding: 40px;
              text-align: center;
              margin-bottom: 20px;
          }
          #imageInput {
              display: none;
          }
          .upload-btn {
              background: #667eea;
              color: white;
              padding: 15px 30px;
              border: none;
              border-radius: 25px;
              cursor: pointer;
              font-size: 16px;
          }
          .settings {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));       
              gap: 20px;
              margin-bottom: 20px;
          }
          .setting-group label {
              display: block;
              margin-bottom: 5px;
              font-weight: bold;
          }
          .setting-group select {
              width: 100%;
              padding: 8px;
              border: 1px solid #ddd;
              border-radius: 5px;
          }
          #imageDisplay {
              text-align: center;
              margin: 20px 0;
          }
          #canvas {
              max-width: 100%;
              border-radius: 10px;
          }
          .results {
              margin-top: 30px;
          }
          .score-display {
              text-align: center;
              font-size: 48px;
              font-weight: bold;
              color: #667eea;
              margin: 20px 0;
          }
      </style>
  </head>
  <body>
      <div class="container">
          <div class="header">
              <h1>â›³ ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
              <p>AIã‚’ä½¿ã£ãŸã‚¢ãƒ‰ãƒ¬ã‚¹å§¿å‹¢ã®è‡ªå‹•è¨ºæ–­</p>
          </div>

          <div class="upload-area">
              <input type="file" id="imageInput" accept="image/*">
              <button class="upload-btn"
  onclick="document.getElementById('imageInput').click()">
                  ğŸ“· å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
              </button>
              <p style="margin-top:
  15px;">ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®å†™çœŸã‚’é¸æŠã—ã¦ãã ã•ã„</p>
          </div>

          <div class="settings">
              <div class="setting-group">
                  <label>åˆ©ãæ‰‹</label>
                  <select id="handedness">
                      <option value="right">å³æ‰“ã¡</option>
                      <option value="left">å·¦æ‰“ã¡</option>
                  </select>
              </div>
              <div class="setting-group">
                  <label>æ’®å½±æ–¹å‘</label>
                  <select id="direction">
                      <option value="front">æ­£é¢</option>
                      <option value="rear">å¾Œæ–¹</option>
                  </select>
              </div>
              <div class="setting-group">
                  <label>ã‚¯ãƒ©ãƒ–</label>
                  <select id="club">
                      <option value="Driver">ãƒ‰ãƒ©ã‚¤ãƒãƒ¼</option>
                      <option value="7I">7ç•ªã‚¢ã‚¤ã‚¢ãƒ³</option>
                      <option value="PW">ãƒ”ãƒƒãƒãƒ³ã‚°ã‚¦ã‚§ãƒƒã‚¸</option>
                  </select>
              </div>
          </div>

          <div id="imageDisplay" style="display: none;">
              <canvas id="canvas"></canvas>
          </div>

          <div id="results" class="results" style="display: none;">
              <h2>è¨ºæ–­çµæœ</h2>
              <div class="score-display" id="totalScore">--</div>
              <div id="feedback"></div>
          </div>
      </div>

      <script>
          let pose;
          let currentImage;

          // MediaPipeåˆæœŸåŒ–
          function initializeMediaPipe() {
              pose = new Pose({
                  locateFile: (file) => {
                      return
  `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/${file}`;
                  }
              });

              pose.setOptions({
                  modelComplexity: 1,
                  smoothLandmarks: true,
                  minDetectionConfidence: 0.5,
                  minTrackingConfidence: 0.5
              });

              pose.onResults(onResults);
          }

          // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
          document.getElementById('imageInput').addEventListener('change',       
  function(e) {
              const file = e.target.files[0];
              if (file) {
                  const reader = new FileReader();
                  reader.onload = function(event) {
                      const img = new Image();
                      img.onload = function() {
                          currentImage = img;
                          analyzeImage(img);
                      };
                      img.src = event.target.result;
                  };
                  reader.readAsDataURL(file);
              }
          });

          // å§¿å‹¢è§£æ
          function analyzeImage(image) {
              document.getElementById('imageDisplay').style.display =
  'block';
              pose.send({image: image});
          }

          // çµæœå‡¦ç†
          function onResults(results) {
              const canvas = document.getElementById('canvas');
              const ctx = canvas.getContext('2d');

              canvas.width = currentImage.width;
              canvas.height = currentImage.height;

              // ç”»åƒã‚’æç”»
              ctx.drawImage(currentImage, 0, 0);

              // ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’æç”»
              if (results.poseLandmarks) {
                  drawLandmarks(ctx, results.poseLandmarks);

                  // ç°¡æ˜“è¨ºæ–­
                  const score =
  performSimpleDiagnosis(results.poseLandmarks);
                  displayResults(score);
              } else {
                  alert('å§¿å‹¢ã‚’æ¤œå‡ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æ˜ã‚‹ã„å ´æ‰€ã§å…¨èº«ãŒå†™ã£      
  ãŸå†™çœŸã‚’ãŠè©¦ã—ãã ã•ã„ã€‚');
              }
          }

          // ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æç”»
          function drawLandmarks(ctx, landmarks) {
              ctx.fillStyle = '#00FF00';
              landmarks.forEach(landmark => {
                  if (landmark.visibility > 0.5) {
                      ctx.beginPath();
                      ctx.arc(
                          landmark.x * ctx.canvas.width,
                          landmark.y * ctx.canvas.height,
                          3, 0, 2 * Math.PI
                      );
                      ctx.fill();
                  }
              });
          }

          // ç°¡æ˜“è¨ºæ–­
          function performSimpleDiagnosis(landmarks) {
              // åŸºæœ¬çš„ãªå§¿å‹¢ãƒã‚§ãƒƒã‚¯
              const leftShoulder = landmarks[11];
              const rightShoulder = landmarks[12];
              const leftHip = landmarks[23];
              const rightHip = landmarks[24];

              // è‚©ã¨è…°ã®æ°´å¹³åº¦ãƒã‚§ãƒƒã‚¯
              const shoulderDiff = Math.abs(leftShoulder.y -
  rightShoulder.y);
              const hipDiff = Math.abs(leftHip.y - rightHip.y);

              let score = 100;
              if (shoulderDiff > 0.05) score -= 20;
              if (hipDiff > 0.05) score -= 15;

              return Math.max(60, score);
          }

          // çµæœè¡¨ç¤º
          function displayResults(score) {
              document.getElementById('results').style.display = 'block';        
              document.getElementById('totalScore').textContent = score +        
  'ç‚¹';

              let feedback = '';
              if (score >= 90) {
                  feedback = 'ğŸ‰ ç´ æ™´ã‚‰ã—ã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ï¼';
              } else if (score >= 75) {
                  feedback = 'ğŸ‘ è‰¯å¥½ãªã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚';
              } else {
                  feedback = 'âš ï¸ æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚';
              }

              document.getElementById('feedback').innerHTML = feedback;
          }

          // åˆæœŸåŒ–
          initializeMediaPipe();
      </script>
  </body>
  </html>

